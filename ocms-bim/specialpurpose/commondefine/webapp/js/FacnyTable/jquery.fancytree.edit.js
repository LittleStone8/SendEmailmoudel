!function(e,t,i,n){"use strict";var r=/Mac/.test(navigator.platform),s=e.ui.fancytree.escapeHtml,a=e.ui.fancytree.unescapeHtml;e.ui.fancytree._FancytreeNodeClass.prototype.editStart=function(){var t,n=this,r=this.tree,s=r.ext.edit,o=r.options.edit,d=e(".fancytree-title",n.span),c={node:n,tree:r,options:r.options,isNew:e(n[r.statusClassPropName]).hasClass("fancytree-edit-new"),orgTitle:n.title,input:null,dirty:!1};if(!1===o.beforeEdit.call(n,{type:"beforeEdit"},c))return!1;e.ui.fancytree.assert(!s.currentNode,"recursive edit"),s.currentNode=this,s.eventData=c,r.widget._unbind(),e(i).on("mousedown.fancytree-edit",function(t){e(t.target).hasClass("fancytree-edit-input")||n.editEnd(!0,t)}),t=e("<input />",{class:"fancytree-edit-input",type:"text",value:r.options.escapeTitles?c.orgTitle:a(c.orgTitle)}),s.eventData.input=t,null!=o.adjustWidthOfs&&t.width(d.width()+o.adjustWidthOfs),null!=o.inputCss&&t.css(o.inputCss),d.html(t),t.focus().change(function(e){t.addClass("fancytree-edit-dirty")}).keydown(function(t){switch(t.which){case e.ui.keyCode.ESCAPE:n.editEnd(!1,t);break;case e.ui.keyCode.ENTER:return n.editEnd(!0,t),!1}t.stopPropagation()}).blur(function(e){return n.editEnd(!0,e)}),o.edit.call(n,{type:"edit"},c)},e.ui.fancytree._FancytreeNodeClass.prototype.editEnd=function(t,n){var r,a=this,o=this.tree,d=o.ext.edit,c=d.eventData,l=o.options.edit,u=e(".fancytree-title",a.span),p=u.find("input.fancytree-edit-input");return l.trim&&p.val(e.trim(p.val())),r=p.val(),c.dirty=r!==a.title,c.originalEvent=n,!1===t?c.save=!1:c.isNew?c.save=""!==r:c.save=c.dirty&&""!==r,!1!==l.beforeClose.call(a,{type:"beforeClose"},c)&&((!c.save||!1!==l.save.call(a,{type:"save"},c))&&(p.removeClass("fancytree-edit-dirty").off(),e(i).off(".fancytree-edit"),c.save?(a.setTitle(o.options.escapeTitles?r:s(r)),a.setFocus()):c.isNew?(a.remove(),a=c.node=null,d.relatedNode.setFocus()):(a.renderTitle(),a.setFocus()),d.eventData=null,d.currentNode=null,d.relatedNode=null,o.widget._bind(),e(o.$container).focus(),c.input=null,l.close.call(a,{type:"close"},c),!0))},e.ui.fancytree._FancytreeNodeClass.prototype.editCreateNode=function(t,i){var n,r=this.tree,s=this;if(t=t||"child",null==i?i={title:""}:"string"==typeof i?i={title:i}:e.ui.fancytree.assert(e.isPlainObject(i)),"child"===t&&!this.isExpanded()&&!1!==this.hasChildren())return void this.setExpanded().done(function(){s.editCreateNode(t,i)});n=this.addNode(i,t),n.match=!0,e(n[r.statusClassPropName]).removeClass("fancytree-hide").addClass("fancytree-match"),n.makeVisible().done(function(){e(n[r.statusClassPropName]).addClass("fancytree-edit-new"),s.tree.ext.edit.relatedNode=s,n.editStart()})},e.ui.fancytree._FancytreeClass.prototype.isEditing=function(){return this.ext.edit?this.ext.edit.currentNode:null},e.ui.fancytree._FancytreeNodeClass.prototype.isEditing=function(){return!!this.tree.ext.edit&&this.tree.ext.edit.currentNode===this},e.ui.fancytree.registerExtension({name:"edit",version:"@VERSION",options:{adjustWidthOfs:4,allowEmpty:!1,inputCss:{minWidth:"3em"},triggerStart:["f2","shift+click","mac+enter"],trim:!0,beforeClose:e.noop,beforeEdit:e.noop,close:e.noop,edit:e.noop,save:e.noop},currentNode:null,treeInit:function(e){this._superApply(arguments),this.$container.addClass("fancytree-ext-edit")},nodeClick:function(t){return e.inArray("shift+click",t.options.edit.triggerStart)>=0&&t.originalEvent.shiftKey?(t.node.editStart(),!1):this._superApply(arguments)},nodeDblclick:function(t){return e.inArray("dblclick",t.options.edit.triggerStart)>=0?(t.node.editStart(),!1):this._superApply(arguments)},nodeKeydown:function(t){switch(t.originalEvent.which){case 113:if(e.inArray("f2",t.options.edit.triggerStart)>=0)return t.node.editStart(),!1;break;case e.ui.keyCode.ENTER:if(e.inArray("mac+enter",t.options.edit.triggerStart)>=0&&r)return t.node.editStart(),!1}return this._superApply(arguments)}})}(jQuery,window,document);