!function(e,t,n,r){"use strict";function o(t,n){n=n||"",t||e.error("Assertion failed "+n)}function d(e,t){e.insertBefore(t,e.firstChild)}function i(e,t){e.parentNode.insertBefore(t,e.nextSibling)}function a(e,t){e.visit(function(e){var n=e.tr;if(n&&(n.style.display=e.hide||!t?"none":""),!e.expanded)return"skip"})}function s(t){var n,r,d,i=t.parent,a=i?i.children:null;if(a&&a.length>1&&a[0]!==t)for(n=e.inArray(t,a),d=a[n-1],o(d.tr);d.children&&d.children.length&&(r=d.children[d.children.length-1],r.tr);)d=r;else d=i;return d}e.ui.fancytree.registerExtension({name:"table",version:"@VERSION",options:{checkboxColumnIdx:null,indentation:16,nodeColumnIdx:0},treeInit:function(t){var r,d,i,a,s,l=t.tree,u=t.options,c=u.table,p=l.widget.element;if(null!=c.customStatus&&(null!=u.renderStatusColumns?e.error("The 'customStatus' option is deprecated since v2.15.0. Use 'renderStatusColumns' only instead."):(l.warn("The 'customStatus' option is deprecated since v2.15.0. Use 'renderStatusColumns' instead."),u.renderStatusColumns=c.customStatus)),u.renderStatusColumns&&!0===u.renderStatusColumns&&(u.renderStatusColumns=u.renderColumns),p.addClass("fancytree-container fancytree-ext-table"),l.tbody=p.find(">tbody")[0],s=e(l.tbody),d=e("thead >tr:last >th",p).length,a=s.children("tr:first"),a.length)i=a.children("td").length,d&&i!==d&&(l.warn("Column count mismatch between thead ("+d+") and tbody ("+i+"): using tbody."),d=i),a=a.clone();else for(o(d>=1,"Need either <thead> or <tbody> with <td> elements to determine column count."),a=e("<tr />"),r=0;r<d;r++)a.append("<td />");a.find(">td").eq(c.nodeColumnIdx).html("<span class='fancytree-node' />"),u.aria&&(a.attr("role","row"),a.find("td").attr("role","gridcell")),l.rowFragment=n.createDocumentFragment(),l.rowFragment.appendChild(a.get(0)),s.empty(),l.statusClassPropName="tr",l.ariaPropName="tr",this.nodeContainerAttrName="tr",l.$container=p,this._superApply(arguments),e(l.rootNode.ul).remove(),l.rootNode.ul=null,this.$container.attr("tabindex",u.tabindex),u.aria&&l.$container.attr("role","treegrid").attr("aria-readonly",!0)},nodeRemoveChildMarkup:function(t){t.node.visit(function(t){t.tr&&(e(t.tr).remove(),t.tr=null)})},nodeRemoveMarkup:function(t){var n=t.node;n.tr&&(e(n.tr).remove(),n.tr=null),this.nodeRemoveChildMarkup(t)},nodeRender:function(t,n,r,l,u){var c,p,h,f,m,y,v,C,g=t.tree,b=t.node,x=t.options,S=!b.parent;if(!1!==g._enableUpdate){if(u||(t.hasCollapsedParents=b.parent&&!b.parent.expanded),!S)if(b.tr&&n&&this.nodeRemoveMarkup(t),b.tr)n?this.nodeRenderTitle(t):this.nodeRenderStatus(t);else{if(t.hasCollapsedParents&&!r)return void b.debug("nodeRender ignored due to unrendered parent");m=g.rowFragment.firstChild.cloneNode(!0),y=s(b),o(y),!0===l&&u?m.style.display="none":r&&t.hasCollapsedParents&&(m.style.display="none"),y.tr?i(y.tr,m):(o(!y.parent,"prev. row must have a tr, or be system root"),d(g.tbody,m)),b.tr=m,b.key&&x.generateIds&&(b.tr.id=x.idPrefix+b.key),b.tr.ftnode=b,x.aria&&e(b.tr).attr("aria-labelledby","ftal_"+b.key),b.span=e("span.fancytree-node",b.tr).get(0),this.nodeRenderTitle(t),x.createNode&&x.createNode.call(g,{type:"createNode"},t)}if(x.renderNode&&x.renderNode.call(g,{type:"renderNode"},t),(c=b.children)&&(S||r||b.expanded))for(h=0,f=c.length;h<f;h++)C=e.extend({},t,{node:c[h]}),C.hasCollapsedParents=C.hasCollapsedParents||!b.expanded,this.nodeRender(C,n,r,l,!0);c&&!u&&(v=b.tr||null,p=g.tbody.firstChild,b.visit(function(e){if(e.tr){if(e.parent.expanded||"none"===e.tr.style.display||(e.tr.style.display="none",a(e,!1)),e.tr.previousSibling!==v){b.debug("_fixOrder: mismatch at node: "+e);var t=v?v.nextSibling:p;g.tbody.insertBefore(e.tr,t)}v=e.tr}}))}},nodeRenderTitle:function(t,n){var r,o,d=t.node,i=t.options,a=d.isStatusNode();return o=this._super(t,n),d.isRootNode()?o:(i.checkbox&&!a&&null!=i.table.checkboxColumnIdx&&(r=e("span.fancytree-checkbox",d.span),e(d.tr).find("td").eq(+i.table.checkboxColumnIdx).html(r)),this.nodeRenderStatus(t),a?i.renderStatusColumns&&i.renderStatusColumns.call(t.tree,{type:"renderStatusColumns"},t):i.renderColumns&&i.renderColumns.call(t.tree,{type:"renderColumns"},t),o)},nodeRenderStatus:function(t){var n,r=t.node,o=t.options;this._super(t),e(r.tr).removeClass("fancytree-node"),n=(r.getLevel()-1)*o.table.indentation,e(r.span).css({paddingLeft:n+"px"})},nodeSetExpanded:function(t,n,r){function o(e){a(t.node,n),e?n&&t.options.autoScroll&&!r.noAnimation&&t.node.hasChildren()?t.node.getLastChild().scrollIntoView(!0,{topNode:t.node}).always(function(){r.noEvents||t.tree._triggerNodeEvent(n?"expand":"collapse",t),d.resolveWith(t.node)}):(r.noEvents||t.tree._triggerNodeEvent(n?"expand":"collapse",t),d.resolveWith(t.node)):(r.noEvents||t.tree._triggerNodeEvent(n?"expand":"collapse",t),d.rejectWith(t.node))}if(n=!1!==n,t.node.expanded&&n||!t.node.expanded&&!n)return this._superApply(arguments);var d=new e.Deferred,i=e.extend({},r,{noEvents:!0,noAnimation:!0});return r=r||{},this._super(t,n,i).done(function(){o(!0)}).fail(function(){o(!1)}),d.promise()},nodeSetStatus:function(t,n,r,o){if("ok"===n){var d=t.node,i=d.children?d.children[0]:null;i&&i.isStatusNode()&&e(i.tr).remove()}return this._superApply(arguments)},treeClear:function(e){return this.nodeRemoveChildMarkup(this._makeHookContext(this.rootNode)),this._superApply(arguments)},treeDestroy:function(e){return this.$container.find("tbody").empty(),this.$source&&this.$source.removeClass("ui-helper-hidden"),this._superApply(arguments)}})}(jQuery,window,document);